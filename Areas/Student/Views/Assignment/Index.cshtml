@{
    ViewData["Title"] = "Assignment";
    Layout = "~/Areas/Student/Views/Shared/_Layout.cshtml";
    var now = DateTime.Now;

    // “Newly uploaded” = created in last 3 days (tweak as you want)
    var newWindowDays = 3;
    var newlyUploaded = (Model ?? Enumerable.Empty<EnglishCenterMVC.Models.Assignment>())
        .Where(a => (now - a.CreateAt).TotalDays <= newWindowDays)
        .OrderByDescending(a => a.CreateAt)
        .ToList();
    var available = (Model ?? Enumerable.Empty<EnglishCenterMVC.Models.Assignment>())
        .Where(a => a.Deadline >= now)
        .OrderBy(a => a.CreateAt)
        .ToList();
    var overdue = (Model ?? Enumerable.Empty<EnglishCenterMVC.Models.Assignment>())
        .Where(a => a.Deadline < now)
        .OrderByDescending(a => a.Deadline)
        .ToList();
}
@model IEnumerable<EnglishCenterMVC.Models.Assignment>


<div class="wrap">

    <!-- Hero -->
    <div class="hero">
        <div class="hero-inner">
            <div>
                <div class="hero-title">Assignments</div>
                <div class="hero-sub">Everything your instructor “sent down the pipeline” lives here. Prioritize by deadline, execute, submit.</div>
                <div class="pillrow">
                    <span class="pill">New: @newlyUploaded.Count</span>
                    <span class="pill">Available: @available.Count</span>
                    <span class="pill">Overdue: @overdue.Count</span>
                </div>
            </div>
            <div class="pill">Student Area</div>
        </div>
    </div>

    <!-- Tabs (future-proof) -->
    <div class="tabs">
        <button class="tab active" type="button">Sent Assignments</button>
        <button class="tab" type="button" disabled style="opacity:.45; cursor:not-allowed;">Submissions (soon)</button>
    </div>

    <div class="grid">
        <!-- LEFT: Lists -->
        <div>

            <!-- Newly uploaded -->
            <div class="cardx card-pad">
                <div class="hrow">
                    <h3>Newly uploaded</h3>
                    <div class="muted">Last @newWindowDays day(s)</div>
                </div>

                @if (!newlyUploaded.Any())
                {
                    <div class="muted" style="margin-top:10px;">No new uploads.</div>
                }
                else
                {
                    <div class="alist">
                        @foreach (var a in newlyUploaded)
                        {
                            var daysLeft = (a.Deadline - now).TotalDays;
                            var isOverdue = a.Deadline < now;
                            var isSoon = !isOverdue && daysLeft <= 2;

                            <div class="a">
                                <div class="a-left">
                                    <div class="ico">✦</div>
                                    <div class="a-text">
                                        <div class="a-title" title="@a.Title">@a.Title</div>
                                        <div class="a-desc">@a.Description</div>

                                        <div class="meta">
                                            <span class="tag">Course #@a.CourseId</span>

                                            @if (isOverdue)
                                            {
                                                <span class="tag danger">Overdue</span>
                                            }
                                            else if (isSoon)
                                            {
                                                <span class="tag warn">Due soon</span>
                                            }
                                            else
                                            {
                                                <span class="tag ok">Open</span>
                                            }

                                            @if (a.UpdateAt != default(DateTime) && a.UpdateAt > a.CreateAt)
                                            {
                                                <span class="tag">Updated: @a.UpdateAt.ToString("dd/MM/yyyy HH:mm")</span>
                                            }
                                        </div>
                                    </div>
                                </div>

                                <div class="a-right">
                                    <a class="btnx primary"
                                       asp-area="Student"
                                       asp-controller="Assignment"
                                       asp-action="Details"
                                       asp-route-courseId="@a.CourseId">
                                        View
                                    </a>

                                    <div class="time">
                                        Created: @a.CreateAt.ToString("dd/MM/yyyy")<br />
                                        Due: @a.Deadline.ToString("dd/MM/yyyy HH:mm")
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>

            <!-- Available assignments (sorted oldest -> newest by CreateAt) -->
            <div class="cardx card-pad" style="margin-top:14px;">
                <div class="hrow">
                    <h3>Available assignments</h3>
                    <div class="muted">Oldest → Newest (CreatedAt)</div>
                </div>

                @if (!available.Any())
                {
                    <div class="muted" style="margin-top:10px;">No available assignments.</div>
                }
                else
                {
                    <div class="alist">
                        @foreach (var a in available)
                        {
                            var daysLeft = (a.Deadline - now).TotalDays;
                            var isSoon = daysLeft <= 2;

                            <div class="a">
                                <div class="a-left">
                                    <div class="ico">≡</div>
                                    <div class="a-text">
                                        <div class="a-title" title="@a.Title">@a.Title</div>
                                        <div class="a-desc">@a.Description</div>

                                        <div class="meta">
                                            <span class="tag">Course #@a.CourseId</span>
                                            <span class="tag @(isSoon ? "warn" : "ok")">@(isSoon ? "Due soon" : "Open")</span>

                                            @if (a.UpdateAt != default(DateTime) && a.UpdateAt > a.CreateAt)
                                            {
                                                <span class="tag">Updated: @a.UpdateAt.ToString("dd/MM/yyyy HH:mm")</span>
                                            }
                                        </div>
                                    </div>
                                </div>

                                <div class="a-right">
                                    <a class="btnx"
                                       href="@(string.IsNullOrWhiteSpace(a.FileUrl) ? "javascript:void(0)" : Url.Content(a.FileUrl))"
                                       target="_blank"
                                       style="@(string.IsNullOrWhiteSpace(a.FileUrl) ? "opacity:.45; pointer-events:none;" : "")">
                                        Download
                                    </a>

                                    <div class="time">
                                        Created: @a.CreateAt.ToString("dd/MM/yyyy")<br />
                                        Due: @a.Deadline.ToString("dd/MM/yyyy HH:mm")
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                }
            </div>

        </div>

        <!-- RIGHT: Sidebar widgets -->
        <div class="cardx widget">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <h3 style="margin:0; font-weight:900;">Overview</h3>
                <span class="tag">Today</span>
            </div>

            <div class="stat">
                <span class="muted">New uploads</span>
                <strong>@newlyUploaded.Count</strong>
            </div>

            <div class="stat">
                <span class="muted">Available</span>
                <strong>@available.Count</strong>
            </div>

            <div class="stat">
                <span class="muted">Overdue</span>
                <strong style="color:var(--danger);">@overdue.Count</strong>
            </div>

            <a class="btnx primary" asp-area="Student" asp-controller="Course" asp-action="Index">Go to Courses</a>
            <a class="btnx" asp-area="Student" asp-controller="Student" asp-action="Dashboard">Back to Dashboard</a>

            <div class="muted" style="margin-top:10px; line-height:1.5;">
                Tip: if an assignment shows “Updated”, re-check the file — instructors love last-minute “minor edits”.
            </div>
        </div>
    </div>
</div>